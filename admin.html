<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard Voucher</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        body { background: #f2f4f7; }
        .sidebar {
            width: 240px; height: 100vh; background: #fff;
            position: fixed; padding: 20px; border-right: 1px solid #ddd;
        }
        .sidebar a {
            padding: 12px; border-radius: 8px; display: block;
            text-decoration: none; color: #333; margin-bottom: 8px;
        }
        .sidebar a.active { background:#4e73df; color:#fff; }
        .content { margin-left:260px; padding:30px; }
        .card-box { padding:20px;border-radius:12px;color:#fff; }
        table th { background:#eef1f7; }
    </style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h4 class="fw-bold mb-4"><i class="fa-solid fa-user-gear"></i> Admin</h4>
    <a class="active"><i class="fa-solid fa-ticket"></i> Voucher</a>
</div>

<!-- CONTENT -->
<div class="content">
    <h3 class="mb-4"><i class="fa-solid fa-ticket"></i> Voucher Dashboard</h3>

    <div class="row mb-4">
        <div class="col-md-3"><div class="card-box bg-primary"><h3 id="total">0</h3>Total</div></div>
        <div class="col-md-3"><div class="card-box bg-success"><h3 id="unused">0</h3>Belum Digunakan</div></div>
        <div class="col-md-3"><div class="card-box bg-danger"><h3 id="used">0</h3>Sudah Digunakan</div></div>
    </div>

    <button class="btn btn-primary" id="buatVoucher">+ Tambah Voucher</button>

    <div class="card mt-3">
        <div class="card-body">
            <table class="table table-bordered table-striped" id="voucherTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Hadiah</th>
                        <th>Kode</th>
                        <th>Status</th>
                        <th>Tanggal</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- FIREBASE SCRIPT -->
<script type="module">
    import { db } from "./firebase-config.js";
    import { ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    function generateCode(l=6){return Array.from({length:l},()=> "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(Math.random()*36)]).join("");}

    document.getElementById("buatVoucher").onclick = () => {
        const hadiah = prompt("Masukkan nilai hadiah:");
        if (!hadiah) return;

        const kode = generateCode();

        const newRef = push(ref(db, "vouchers"));
        set(newRef, {
            hadiah,
            kode,
            status: "Belum Digunakan",
            created_at: new Date().toISOString()
        });

        alert("Voucher dibuat!\nKode: " + kode);
    };

    const voucherRef = ref(db, "vouchers");
    onValue(voucherRef, (snapshot) => {
        const tbody = document.querySelector("#voucherTable tbody");
        tbody.innerHTML = "";

        let total=0, used=0, unused=0;

        snapshot.forEach(child => {
            const data = child.val();
            total++;
            if (data.status === "Sudah Digunakan") used++;
            else unused++;

            tbody.innerHTML += `
                <tr>
                    <td>${child.key}</td>
                    <td>${data.hadiah}</td>
                    <td>${data.kode}</td>
                    <td>${data.status}</td>
                    <td>${data.created_at}</td>
                </tr>
            `;
        });

        document.getElementById("total").innerText = total;
        document.getElementById("unused").innerText = unused;
        document.getElementById("used").innerText = used;
    });
</script>

</body>
</html>
