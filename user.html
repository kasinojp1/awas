<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Cek Voucher</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">

<div class="container mt-5">
    <div class="card p-4 shadow">
        <h3 class="mb-3">Masukkan Kode Voucher</h3>

        <input id="kode" class="form-control mb-3" placeholder="Contoh: A1B2C3">
        <button class="btn btn-primary w-100" id="cekBtn">Cek Voucher</button>
    </div>
</div>

<script type="module">
    import { db } from "./firebase-config.js";
    import { ref, get, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    document.getElementById("cekBtn").onclick = async () => {
        const kode = document.getElementById("kode").value.trim();
        if (!kode) return alert("Masukkan kode!");

        const snap = await get(ref(db, "vouchers"));
        if (!snap.exists()) return alert("Tidak ada voucher!");

        let valid = false;

        snap.forEach(child => {
            const v = child.val();

            if (v.kode === kode) {
                valid = true;

                if (v.status === "Sudah Digunakan") {
                    alert("Kode sudah digunakan!");
                } else {
                    update(ref(db, "vouchers/" + child.key), {
                        status: "Sudah Digunakan",
                        used_at: new Date().toISOString()
                    });
                    alert("Voucher valid! Hadiah: " + v.hadiah);
                }
            }
        });

        if (!valid) alert("Kode salah!");
    };
</script>

</body>
</html>
